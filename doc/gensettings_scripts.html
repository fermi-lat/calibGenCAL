<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<!-- $Header$ -->
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=utf-8">
	<TITLE></TITLE>
	<META NAME="GENERATOR" CONTENT="OpenOffice.org 1.9.129  (Linux)">
	<META NAME="AUTHOR" CONTENT="space science">
	<META NAME="CREATED" CONTENT="20050911;13480000">
	<META NAME="CHANGED" CONTENT="20051118;11094400">
	<STYLE>
	<!--
		@page { size: 8.5in 11in; margin-left: 0.79in; margin-right: 1.25in; margin-top: 1in; margin-bottom: 1in }
		TD P { margin-bottom: 0.08in; direction: ltr; color: #000000; widows: 2; orphans: 2 }
		TD P.western { font-family: "Times New Roman", serif; font-size: 12pt; so-language: en-US }
		TD P.cjk { font-family: "Times New Roman", serif; font-size: 12pt }
		TD P.ctl { font-family: "Times New Roman", serif; font-size: 12pt; so-language: ar-SA }
		P { margin-bottom: 0.08in; direction: ltr; color: #000000; widows: 2; orphans: 2 }
		P.western { font-family: "Times New Roman", serif; font-size: 12pt; so-language: en-US }
		P.cjk { font-family: "Times New Roman", serif; font-size: 12pt }
		P.ctl { font-family: "Times New Roman", serif; font-size: 12pt; so-language: ar-SA }
		H2 { margin-bottom: 0.04in; direction: ltr; color: #000000; widows: 2; orphans: 2 }
		H2.western { font-family: "Arial", sans-serif; font-size: 14pt; so-language: en-US; font-style: italic }
		H2.cjk { font-family: "Times New Roman", serif; font-size: 14pt; font-style: italic }
		H2.ctl { font-family: "Arial", sans-serif; font-size: 14pt; so-language: ar-SA; font-style: italic }
		H3 { margin-bottom: 0.04in; direction: ltr; color: #000000; widows: 2; orphans: 2 }
		H3.western { font-family: "Arial", sans-serif; font-size: 13pt; so-language: en-US }
		H3.cjk { font-family: "Times New Roman", serif; font-size: 13pt }
		H3.ctl { font-family: "Arial", sans-serif; font-size: 13pt; so-language: ar-SA }
	-->
	</STYLE>
</HEAD>
<BODY LANG="en-US" TEXT="#000000" DIR="LTR">
<P CLASS="western">Automated Generation of LAT CAL DAC Settings XML
Files</P>
<H2 CLASS="western">1.Introduction</H2>
<P CLASS="western" STYLE="margin-left: 0.31in">Early in the
multi-tower I&amp;T process, we realized that generating DAC settings
for multiple towers was a tedious and possibly error-prone process if
done by hand. In particular, 4 separate DAC settings files had to be
generated for each of up to 16 towers. Even the advent of the
genXXXsettings.py scripts created by Dan Wood, which performed the
calculations and wrote the XML output for each of the settings files,
did not relieve the tedium, as each script run requires a
configuration file and command line to be set up. Clearly, a higher
level of automation was required.</P>
<H2 CLASS="western">2.Description</H2>
<P CLASS="western" STYLE="margin-left: 0.31in">The four scripts
<B>get_slac_calibdac.py, build_acdsmooth.py, build_gensettings_cfg.py</B>
and <B>gensettings.py</B> automate the process of generating DAC
settings using the genXXXsettings.py (genFLEsettings.py,
genFHEsiettings.py, genLACsettings.py and genULDsettings.py) scripts.
They are meant to operate in the LAT I&amp;T environment, in that
they assume run numbers and file names as generated by the I&amp;T
version of the calibDAC suite and subsequent pipeline analyses.</P>
<P CLASS="western" STYLE="margin-left: 0.31in; margin-top: 0.17in">Note
that three of these scripts (<B>get_slac_calibdac.py,
build_acdsmooth.py </B>and <B>gensettings.py</B>) build a batch file
of commands to execute. In the case of <B>get_slac_calibdac.py</B>,
the commands are not part of the SAS software install (other than
SSH/SCP), and can be run from anywhere if paths are set up to
recognize SCP. The other batch files (generated by <B>build_acdsmooth.py</B>
and <B>gensettings.py</B>) execute calibGenCAL python scripts and
must be run from an environment in which the CALIBGENCALROOT
environment variable is defined. The easiest way to do this is to
“spawn” a command prompt window from MRvcmt while calibGenCAL is
selected as the current package. In order to avoid having to run any
of these scripts in this environment, batch files that use
calibGenCAL routines and hence require CALIBGENCALROOT to be set are
not executed from within the Python scripts that produce them (i.e.
<B>build_acdsmooth.py</B> and <B>gensettings.py</B>)</P>
<P CLASS="western" STYLE="margin-left: 0.31in">The scripts are run
sequentially: <B>get_slac_calibdac.py</B> takes as input run numbers
of “suite summary” runs associated with the execution of the
calibDAC suite. One run number is required for each module for which
settings are to be generated. The script then builds a batch file of
SCP commands that copy the relevant files (relgain and
characterization files) from the SLAC archive to the local computer
on which the genXXXsettings scripts will be run. Finally, the script
executes the batch file.</P>
<P CLASS="western" STYLE="margin-left: 0.31in"><B>build_acdsmooth.py</B>
identifies files required for each module using the file names and
creates and executes a batch file with adcsmooth commands to produce
“filtered” characterization files for fle, fhe, lac and uld. The
filtered files have “_filtered” postpended to the filename. Since</P>
<P CLASS="western" STYLE="margin-left: 0.31in"><B>build_gensettings_cfg.py</B>
identifies the files for each module and, using the file names,
builds a configuration file for gensettings.py, containing the file
names and module configuration information for each module and
genXXXsettings.py script.</P>
<P CLASS="western" STYLE="margin-left: 0.31in"><B>gensettings.py </B>uses
the configuration file built by <B>build_gensetting_cfg.py</B> (or by
hand) to generate separate config files for each genXXXsettings.py
run (one per desired settings table and module). It also builds a
batch file of the commands that will run the genXXXsettings.py
scripts.</P>
<H2 CLASS="western">3.Setup</H2>
<H3 CLASS="western" STYLE="margin-left: 0.31in">get_slac_calibdac.py</H3>
<P CLASS="western" STYLE="margin-left: 0.62in"><B>get_slac_calibdac.py</B>
is controlled by a config file and run without any command line
arguments. The following is a sample config file, which must be named
<B>get_slac_calibdac.cfg</B> and must be located in the current
folder:</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">[SETUP]</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">slacuser=strickmn</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">batfileroot=str34_scp</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">[FM112]</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">summary=139005695</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">disk=u19</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">[FM117]</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">summary=135006789</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">fle2adcrun=138001234</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">lac2adcrun=138001236</P>
<P CLASS="western" STYLE="margin-left: 0.62in">disk=u21</P>
<P CLASS="western" STYLE="margin-left: 0.62in">The config file items
are described below:</P>
<UL>
	<LI><P CLASS="western">[SETUP]</P>
	<UL>
		<LI><P CLASS="western">Required section</P>
		<LI><P CLASS="western">Options</P>
		<UL>
			<LI><P CLASS="western">slacuser - (required) specifies username
			for SSH logon to slac unix cluster. Note that user must have the
			standard GLAST/SAS software environment SSH setup installed, which
			allows SSH login via public/private key rather than passwords</P>
			<LI><P CLASS="western">batfileroot - (optional) specifies the
			filename root for the batch file output which contains the SCP
			commands to execute. If not present, default of <I>scpcmds</I> is
			used. batfileroot can contain path information as well as a
			filename root, but should use forward slashes (/) to separate
			folders</P>
		</UL>
	</UL>
	<LI><P CLASS="western">[FMXXX]</P>
	<UL>
		<LI><P CLASS="western">At least one section required</P>
		<LI><P CLASS="western">Each section contains information for one
		module (XXX is the module serial number, 112 and 117 in the sample)</P>
		<LI><P CLASS="western">Options</P>
		<UL>
			<LI><P CLASS="western">summary - (required unless all other run
			numbers are set) specifies the I&amp;T pipeline run number of the
			“suite summary” for the desired calibDAC run. If summary is
			specified, and no individual run numbers are included, the run
			numbers of the scripts that produce the desired products are
			constructed from the summary run number as follows:</P>
		</UL>
	</UL>
</UL>
<TABLE WIDTH=800 BORDER=2 BORDERCOLOR="#000000" CELLPADDING=10 CELLSPACING=0>
	<COL WIDTH=259>
	<COL WIDTH=232>
	<COL WIDTH=245>
	<TR VALIGN=TOP>
		<TD WIDTH=259>
			<P CLASS="western" STYLE="margin-left: 0.75in"><U><B>Script</B></U></P>
		</TD>
		<TD WIDTH=232>
			<P CLASS="western" STYLE="margin-left: 0.75in"><U><B>Product</B></U></P>
		</TD>
		<TD WIDTH=245>
			<P CLASS="western" STYLE="margin-left: 0.75in"><U><B>Run</B></U></P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=259>
			<P CLASS="western" STYLE="margin-left: 0.75in">calu_pedestals_ci</P>
		</TD>
		<TD WIDTH=232>
			<P CLASS="western" STYLE="margin-left: 0.75in">pedestals</P>
		</TD>
		<TD WIDTH=245>
			<P CLASS="western" STYLE="margin-left: 0.75in">summary - 6</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=259>
			<P CLASS="western" STYLE="margin-left: 0.75in">Calf_gain_p01</P>
		</TD>
		<TD WIDTH=232>
			<P CLASS="western" STYLE="margin-left: 0.75in">relgain</P>
		</TD>
		<TD WIDTH=245>
			<P CLASS="western" STYLE="margin-left: 0.75in">summary - 5</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=259>
			<P CLASS="western" STYLE="margin-left: 0.75in">Calf_trg_p03</P>
		</TD>
		<TD WIDTH=232>
			<P CLASS="western" STYLE="margin-left: 0.75in">fle2adc</P>
		</TD>
		<TD WIDTH=245>
			<P CLASS="western" STYLE="margin-left: 0.75in">summary - 4</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=259>
			<P CLASS="western" STYLE="margin-left: 0.75in">Calf_trg_p03</P>
		</TD>
		<TD WIDTH=232>
			<P CLASS="western" STYLE="margin-left: 0.75in">fhe2adc</P>
		</TD>
		<TD WIDTH=245>
			<P CLASS="western" STYLE="margin-left: 0.75in">summary - 3</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=259>
			<P CLASS="western" STYLE="margin-left: 0.75in">Calf_supp_p01</P>
		</TD>
		<TD WIDTH=232>
			<P CLASS="western" STYLE="margin-left: 0.75in">lac2adc</P>
		</TD>
		<TD WIDTH=245>
			<P CLASS="western" STYLE="margin-left: 0.75in">summary - 2</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=259>
			<P CLASS="western" STYLE="margin-left: 0.75in">Calf_rng_p01</P>
		</TD>
		<TD WIDTH=232>
			<P CLASS="western" STYLE="margin-left: 0.75in">uld2adc</P>
		</TD>
		<TD WIDTH=245>
			<P CLASS="western" STYLE="margin-left: 0.75in">summary - 1</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" STYLE="margin-left: 0.62in"><BR><BR>
</P>
<UL>
	<UL>
		<UL>
			<LI><P CLASS="western">Note that very early calibDAC runs had
			calu_init runs interspersed, resulting in a different relationship
			of script run number to summary. These are not currently handled
			correctly.</P>
			<LI><P CLASS="western">relgainrun, fle2adcrun, fhe2adcrun,
			lac2adcrun, uld2adcrun, pedestalrun - (optional) allow the default
			run numbers derived from summary to be overridden or skipped
			altogether. If any of these options is set to a run number, that
			run is used in lieu of that derived from summary. If the option is
			set to ‘skip’, that product is not copied</P>
			<LI><P CLASS="western">disk - (optional) specifies the name of the
			disk on which all the products for the module can be found (they
			all must be on the same disk). Defaults to u21. The path used to
			point at to products at SLAC is
			/nfs/garm/g/glast/DDD/Integration/rawData/RRRRRRRRR where DDD is
			the disk name and RRRRRRRRR is the run number</P>
		</UL>
	</UL>
</UL>
<P CLASS="western" STYLE="margin-left: 0.62in">Outputs from
<B>get_slac_calibdac.py</B> include the batch file of SCP commands,
the downloaded files that result from execution of the batch file,
and a log file from the batch file execution.  This batch file may be
run either in Windows or Linux/UNIX.</P>
<H3 CLASS="western" STYLE="margin-left: 0.31in">build_acdsmooth.py</H3>
<P CLASS="western" STYLE="margin-left: 0.62in"><B>build_acdsmooth.py
</B>is controlled by a configuration file and a command line
parameter. The command line parameter looks like -<B>f fileroot </B>or
<B>--file fileroot</B> where fileroot is the path and root of the
input configuration file. If the command line argument is not
present, the input configuration filename defaults to
<B>build_adcsmooth.cfg</B> in the current folder. The following is a
sample config. File:</P>
<P CLASS="western" STYLE="margin-left: 0.62in">[FM104]</P>
<P CLASS="western" STYLE="margin-left: 0.62in">[FM103]</P>
<P CLASS="western" STYLE="margin-left: 0.62in">flename = skip</P>
<P CLASS="western" STYLE="margin-left: 0.62in">fhename = test123.xml</P>
<P CLASS="western" STYLE="margin-left: 0.62in">[FM105]</P>
<P CLASS="western" STYLE="margin-left: 0.62in">[FM102]</P>
<P CLASS="western" STYLE="margin-left: 0.62in">[FM107]</P>
<P CLASS="western" STYLE="margin-left: 0.62in">[FM106]</P>
<P CLASS="western" STYLE="margin-left: 0.62in">[FM110]</P>
<P CLASS="western" STYLE="margin-left: 0.62in">[FM108]</P>
<P CLASS="western" STYLE="margin-left: 0.62in">Note that most of the
module sections are empty. This is the normal mode of operation, in
which <B>build_adcsmooth.py</B> finds the required characterization
files to filter using pattern matching on the file names. If it finds
more than one file matching the pattern, it terminates with an error.
Options include adding filenames to override the automatic filename
determination or adding “skip” to not process that particular
file. These are shown in the [FM103] section.</P>
<P CLASS="western" STYLE="margin-left: 0.62in">The patterns used by
the automatic pattern matching default are shown in the following
table:</P>
<TABLE WIDTH=800 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=10 CELLSPACING=0>
	<COL WIDTH=379>
	<COL WIDTH=380>
	<TR VALIGN=TOP>
		<TD WIDTH=379>
			<P CLASS="western"><U><B>Type of Characterization File</B></U></P>
		</TD>
		<TD WIDTH=380>
			<P CLASS="western"><U><B>Pattern matching code (matched using
			glob))</B></U></P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=379>
			<P CLASS="western">FLE</P>
		</TD>
		<TD WIDTH=380>
			<P CLASS="western">'*'+idet+'*fle2adc*.xml'</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=379>
			<P CLASS="western">FHE</P>
		</TD>
		<TD WIDTH=380>
			<P CLASS="western">'*'+idet+'*fhe2adc*.xml'</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=379>
			<P CLASS="western">LAC</P>
		</TD>
		<TD WIDTH=380>
			<P CLASS="western">'*'+idet+'*lac2adc*.xml'</P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=379>
			<P CLASS="western">ULD</P>
		</TD>
		<TD WIDTH=380>
			<P CLASS="western">('*'+idet+'*uld2adc*.xml’</P>
		</TD>
	</TR>
</TABLE>
<P CLASS="western" STYLE="margin-left: 0.62in"><BR><BR>
</P>
<P CLASS="western" STYLE="margin-left: 0.62in">Outputs from
<B>build_acdsmooth.py</B> include a windows batch file and a UNIX .sh
script containing <B>acdsmooth.py</B> run commands. When executed
(outside of the script), these result in filtered characterization
files, with “_filtered” added to the end of each file name.  
</P>
<H3 CLASS="western" STYLE="margin-left: 0.31in">build_gensettings_cfg.py</H3>
<P CLASS="western" STYLE="margin-left: 0.62in"><B>build_gensettings_cfg.py</B>
is controlled by a configuration file and a command line parameter.
The latter must look like <B>-f fileroot</B> or <B>--file fileroot</B>,
where fileroot is the path and name root of the input configuration
file. If the command line argument is not present, the input
configuration filename defaults to <B>build_gensettings_cfg.cfg</B>
in the current folder<B>. </B>The following is a sample config file:</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">[FM105]</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">filepath=.</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">config=1</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">tower=4</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in"><BR>
</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">[FM102]</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">filepath=.</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">config=1</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">tower=5</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in"><BR>
</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">[CFG1]</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">legain=5</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">hegain=15</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">hegainmu=0</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">lac=2</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">fle=100</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">fhe=1</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">adcmargin=50</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in"><BR>
</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">[OUTPUT]</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">outputpath=./mydir</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">outfilename=gensettings_str34_8twr_flight.cfg</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-top: 0.08in; margin-bottom: 0in">
The config. Items are described below:</P>
<UL>
	<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
	[FMXXX]</P>
	<UL>
		<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
		At least one section required</P>
		<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
		Options:</P>
		<UL>
			<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
			filepath - [required] specifies the path to the files to be
			searched (without a trailing slash). If the current directory is
			desired, enter “.”</P>
			<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
			config - [optional; defaults to 1] specifies configuration section
			to be used to define settings for this module. If set to 1,
			configuration section is labeled [CFG1], etc.</P>
			<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
			tower - [required] specifies the tower number to be used as both
			source and destination towers in the genXXXsettings
			configurations. Note that genXXXsettings.py currently requires all
			files for a given run have the same source tower value. If this is
			not the case (typically for relgain files), the file in question
			must be edited and the TEM ID or GEM ID tag (depending on file
			type) altered to be the same as the rest of files.</P>
		</UL>
	</UL>
	<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
	[CFGX]</P>
	<UL>
		<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
		At least one section required</P>
		<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
		Options</P>
		<UL>
			<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
			legain - [required] LE gain setting</P>
			<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
			hegain - [required] HE gain setting (flight mode)</P>
			<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
			hegainmu - [required] HE gain setting (muon mode)</P>
			<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
			lac - [required] LAC threshold setting in MeV</P>
			<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
			fle - [required] FLE threshold setting in MeV</P>
			<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
			fhe - [required] FHE threshold setting in GeV</P>
			<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
			adcmargin - [required] adcmargin setting for ULD setting
			calculation (ADC units)</P>
		</UL>
	</UL>
	<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
	[OUTPUT]</P>
	<UL>
		<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
		Optional section</P>
		<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
		Options</P>
		<UL>
			<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
			outfilepath - [optional; defaults to “.”] specifies path to
			output gensettings config file.</P>
			<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
			outfilename - [optional; defaults to “gensettings.cfg”]
			specifies name of output gensettings config file.</P>
		</UL>
	</UL>
</UL>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-top: 0.08in; margin-bottom: 0in">
Output of <B>build_gensettings_cfg.py</B> includes a single
configuration file for <B>gensettings.py</B>. 
</P>
<H3 CLASS="western" STYLE="margin-left: 0.31in">gensettings.py</H3>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-top: 0.08in; margin-bottom: 0in">
<B>gensettings.py</B> is controlled by a configuration file as
produced by <B>build_gensettings.py</B> and an optional command line
parameter. The latter must look like <B>-f fileroot </B>or <B>--file
fileroot </B>where fileroot is the path and root of the input
configuration file. If the command line parameter is not specified,
the input configuration file name defaults to gensettings.cfg. A
sample configuration file looks like:</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-top: 0.08in; margin-bottom: 0in">
<BR>
</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">[FM108]</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">adc2nrgname
= .\135004384_T13_FM108_cal_adc2nrg.xml</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">biasname
= .\135004348_T13_FM108_cal_bias.xml</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">relgainname
= .\050817174256_FM108_CAL_relgain.xml</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">flename
= .\050817174720_G5_FM108_CAL_fle2adc_filtered.xml</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">fhename
= .\050817200154_G13_FM108_CAL_fhe2adc_filtered.xml</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">lacname
= .\050817213823_G5_FM108_CAL_lac2adc_filtered.xml</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">uldname
= .\050817214637_G5_FM108_CAL_uld2adc_filtered.xml</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">src
= 13</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">dest
= 13</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">config
= 1</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">.</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">.</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">.</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">[CFG1]</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">legain
= 5</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">hegain
= 15</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">fhe
= 1</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">lac
= 2</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">adcmargin
= 50</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">hegainmu
= 0</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-bottom: 0in">fle
= 100</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-top: 0.08in; margin-bottom: 0in">
Note that the config file can have as many [FMXXX] sections as
required for the number of modules for which settings are being
generated, and can have up to 10 [CFGX] sections. In real life, most
applications will only require one [CFGX] section for all modules.</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-top: 0.08in; margin-bottom: 0in">
The config. Items are described below:</P>
<UL>
	<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
	[FMXXX]</P>
	<UL>
		<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
		At least one section required</P>
		<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
		Options:</P>
		<UL>
			<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
			*name - [required] specifies the adc2nrg, bias,relgain, fle2adc,
			fhe2adc, lac2adc and uld2adc xml file path and name (current
			directory if no path specified). If fle, fhe, lac or uld is set to
			“skip”, a genXXXsettings config and batch command are not
			generated for that quantity.</P>
			<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
			src - [required] specifies source tower number. Must match the
			TEMID or GEMID tags in the source (i.e. adc2nrg, bias, etc.)
			files. All files must have the same source tower number. If they
			don’t, they must be edited to be the same.</P>
			<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
			dest - [required] specifies the destination tower number to be
			used in the output DAC settings xml files</P>
			<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
			config - [required] specifies configuration section to be used to
			define settings for this module. If set to 1, configuration
			section is labeled [CFG1], etc.</P>
		</UL>
	</UL>
	<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
	[CFGX]</P>
	<UL>
		<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
		At least one section required</P>
		<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
		Options</P>
		<UL>
			<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
			legain - [required] LE gain setting</P>
			<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
			hegain - [required] HE gain setting (flight mode)</P>
			<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
			hegainmu - [required] HE gain setting (muon mode)</P>
			<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
			lac - [required] LAC threshold setting in MeV</P>
			<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
			fle - [required] FLE threshold setting in MeV</P>
			<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
			fhe - [required] FHE threshold setting in GeV</P>
			<LI><P CLASS="western" STYLE="margin-top: 0.08in; margin-bottom: 0in">
			adcmargin - [required] adcmargin setting for ULD setting
			calculation (ADC units)</P>
		</UL>
	</UL>
</UL>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-top: 0.08in; margin-bottom: 0in">
Output of <B>gensettings.py</B> includes a configuration file and
command line in a batch file for each DAC settings xml file (fle,
fhe, lac and uld) and module as specified by the gensettings
configuration file. If all four settings files are requested for 16
modules, the output would consist of 64 configuration files (4 x 16)
and one batch file with 64 command lines. As mentioned above, the
batch file must be executed from an environment in which the
CALIBGENCAL environment variable is defined.</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-top: 0.08in; margin-bottom: 0in">
<I>Note: </I>A sh script is generated in parallel w/ the batch file
for use on Linux</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-top: 0.08in; margin-bottom: 0in">
The output configuration files are defined (for example, in the case
of an FLE file) by the Python code fragment:
fileroot+'_'+idet+&quot;genFLE.cfg&quot; where fileroot is the
variable passed in the <B>gensettings.p</B>y command line and idet is
the module number expressed as, for example, FM104.</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-top: 0.08in; margin-bottom: 0in">
The batch file containing the command lines is named fileroot+”.bat”,
the sh script is fileroot+&quot;.sh&quot;</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-top: 0.08in; margin-bottom: 0in">
A sample command line from a batch file output looks like:</P>
<P CLASS="western" STYLE="margin-left: 1.23in; text-indent: -0.4in; margin-top: 0.08in; margin-bottom: 0in">
python %CALIBGENCALROOT%\python\genFLEsettings.py -V 100
gensettings_str34_8twr_flight_FM108genFLE.cfg
050915234940_G5_MeV100_FM108_CAL_fle.xml</P>
<P CLASS="western" STYLE="margin-left: 0.62in; margin-top: 0.08in; margin-bottom: 0in">
This shows the use of the CALIBGENCALROOT environment variable (here
for windows) and the naming convention for the xml output file from
the genFLEsettings.py script. Note that the output file name starts
with a time tag and includes, in this case, the gain and FLE setting
values.</P>
</BODY>
</HTML>