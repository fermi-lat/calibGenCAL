<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
  <meta name="generator"
 content="HTML Tidy for Linux/x86 (vers 12 April 2005), see www.w3.org">
<!-- $Header: /nfs/slac/g/glast/ground/cvs/calibGenCAL/doc/gensettings_scripts.html,v 1.4 2006/01/13 17:15:51 fewtrell Exp $ -->
  <meta http-equiv="CONTENT-TYPE" content="text/html; charset=us-ascii">
  <title></title>
  <meta name="GENERATOR" content="OpenOffice.org 1.9.129 (Linux)">
  <meta name="AUTHOR" content="space science">
  <meta name="CREATED" content="20050911;13480000">
  <meta name="CHANGED" content="20051118;11094400">
  <style type="text/css">
        <!--
                @page { size: 8.5in 11in; margin-left: 0.79in; margin-right: 1.25in; margin-top: 1in; margin-bottom: 1in }
                TD P { margin-bottom: 0.08in; direction: ltr; color: #000000; widows: 2; orphans: 2 }
                TD P.western { font-family: "Times New Roman", serif; font-size: 12pt; so-language: en-US }
                TD P.cjk { font-family: "Times New Roman", serif; font-size: 12pt }
                TD P.ctl { font-family: "Times New Roman", serif; font-size: 12pt; so-language: ar-SA }
                P { margin-bottom: 0.08in; direction: ltr; color: #000000; widows: 2; orphans: 2 }
                P.western { font-family: "Times New Roman", serif; font-size: 12pt; so-language: en-US }
                P.cjk { font-family: "Times New Roman", serif; font-size: 12pt }
                P.ctl { font-family: "Times New Roman", serif; font-size: 12pt; so-language: ar-SA }
                H2 { margin-bottom: 0.04in; direction: ltr; color: #000000; widows: 2; orphans: 2 }
                H2.western { font-family: "Arial", sans-serif; font-size: 14pt; so-language: en-US; font-style: italic }
                H2.cjk { font-family: "Times New Roman", serif; font-size: 14pt; font-style: italic }
                H2.ctl { font-family: "Arial", sans-serif; font-size: 14pt; so-language: ar-SA; font-style: italic }
                H3 { margin-bottom: 0.04in; direction: ltr; color: #000000; widows: 2; orphans: 2 }
                H3.western { font-family: "Arial", sans-serif; font-size: 13pt; so-language: en-US }
                H3.cjk { font-family: "Times New Roman", serif; font-size: 13pt }
                H3.ctl { font-family: "Arial", sans-serif; font-size: 13pt; so-language: ar-SA }
        -->
  </style>
</head>
<body dir="ltr" lang="en-US" text="#000000">
<p class="western">Automated Generation of LAT CAL DAC Settings XML
Files</p>
<h2 class="western">1.Introduction</h2>
<p class="western" style="margin-left: 0.31in;">Early in the
multi-tower I&amp;T process, we realized that generating DAC settings
for multiple towers was a tedious and possibly error-prone process if
done by hand. In particular, 4 separate DAC settings files had to be
generated for each of up to 16 towers. Even the advent of the
genXXXsettings.py scripts created by Dan Wood, which performed the
calculations and wrote the XML output for each of the settings files,
did not relieve the tedium, as each script run requires a configuration
file and command line to be set up. Clearly, a higher level of
automation was required.</p>
<h2 class="western">2.Description</h2>
<p class="western" style="margin-left: 0.31in;">The four scripts <b>get_slac_calibdac.py,
build_acdsmooth.py, build_gensettings_cfg.py</b> and <b>gensettings.py</b>
automate the process of generating DAC settings using the
genXXXsettings.py (genFLEsettings.py, genFHEsiettings.py,
genLACsettings.py and genULDsettings.py) scripts. They are meant to
operate in the LAT I&amp;T environment, in that they assume run numbers
and file names as generated by the I&amp;T version of the calibDAC
suite and subsequent pipeline analyses.</p>
<p class="western" style="margin-left: 0.31in; margin-top: 0.17in;">Note
that three of these scripts (<b>get_slac_calibdac.py, build_acdsmooth.py</b>
and <b>gensettings.py</b>) build a batch file of commands to execute.
In the case of <b>get_slac_calibdac.py</b>, the commands are not part
of the SAS software install (other than SSH/SCP), and can be run from
anywhere if paths are set up to recognize SCP. The other batch files
(generated by <b>build_acdsmooth.py</b> and <b>gensettings.py</b>)
execute calibGenCAL python scripts and must be run from an environment
in which the CALIBGENCALROOT environment variable is defined. The
easiest way to do this is to &#226;&#8364;&#339;spawn&#226;&#8364; a command prompt window from
MRvcmt while calibGenCAL is selected as the current package. In order
to avoid having to run any of these scripts in this environment, batch
files that use calibGenCAL routines and hence require CALIBGENCALROOT
to be set are not executed from within the Python scripts that produce
them (i.e. <b>build_acdsmooth.py</b> and <b>gensettings.py</b>)</p>
<p class="western" style="margin-left: 0.31in;">The scripts are run
sequentially: <b>get_slac_calibdac.py</b> takes as input run numbers
of &#226;&#8364;&#339;suite summary&#226;&#8364; runs associated with the execution of the
calibDAC suite. One run number is required for each module for which
settings are to be generated. The script then builds a batch file of
SCP commands that copy the relevant files (relgain and characterization
files) from the SLAC archive to the local computer on which the
genXXXsettings scripts will be run. Finally, the script executes the
batch file.</p>
<p class="western" style="margin-left: 0.31in;"> <b>build_acdsmooth.py</b>
identifies files required for each module using the file names and
creates and executes a batch file with adcsmooth commands to produce
&#226;&#8364;&#339;filtered&#226;&#8364; characterization files for fle, fhe, lac and uld. The
filtered files have &#226;&#8364;&#339;_filtered&#226;&#8364; postpended to the filename. <span
 style="font-weight: bold;">build_adcsmooth.py</span> also generates
validation plots &amp; logs using <span style="font-weight: bold;">charPlot.py</span>
&amp; <span style="font-weight: bold;">charVal.py</span> scripts.<br>
</p>
<p class="western" style="margin-left: 0.31in;"> <b>build_gensettings_cfg.py</b>
identifies the files for each module and, using the file names, builds
a configuration file for gensettings.py, containing the file names and
module configuration information for each module and genXXXsettings.py
script.</p>
<p class="western" style="margin-left: 0.31in;"> <b>gensettings.py</b>
uses the configuration file built by <b>build_gensetting_cfg.py</b>
(or by hand) to generate separate config files for each
genXXXsettings.py run (one per desired settings table and module). It
also builds a batch file of the commands that will run the
genXXXsettings.py scripts. This batch file will also generate
validation plots &amp; logs for the new dac settings scripts by
invoking the <span style="font-weight: bold;">dacVal.py</span> script.<br>
</p>
<h2 class="western">3. General Usage<br>
</h2>
<p class="western" style="margin-left: 0.31in;"><span
 style="font-weight: bold;">Command Line Usage:<br>
</span>Most calibGenCAL python scripts will print a usage/help
statement to screen if they are invoked with no arguments.<span
 style="font-weight: bold;"><br>
</span><span style="font-weight: bold;"></span></p>
<p class="western" style="margin-left: 0.31in;"><span
 style="font-weight: bold;">Launcher Scripts:</span><br
 style="font-weight: bold;">
For each calibGenCAL python script XYZ.py there exists on XYZ.bat
script for windows shell use and one XYZ.sh launcher script for Linux
shell use.&nbsp; The 'xxx.sh' scripts have UNIX executable permission
bit set and CMT setup of calibGenCAL package will put these launcher
scripts in the system path.&nbsp; The user can launch any calibGenCAL
python script simply by typing the name&nbsp; of the appropriate
launcher script into the shell.&nbsp; All commandline paramters to the
launcher script will be passeed directly onto the python script.<br>
</p>
<p class="western" style="margin-left: 0.31in;"><span
 style="font-weight: bold;">End2End Run-Thru quick reference:</span><br>
the file <span style="font-weight: bold;">$CALIBGENCALROOT/doc/calibGenCAL_configurationRecord_howto.txt</span>
contains minimal instructions for a basic runthrough of the gensettings
script suite.<br>
</p>
<br>
<h2 class="western">4. Script Setup</h2>
<h3 class="western" style="margin-left: 0.31in;"> get_slac_calibdac.py</h3>
<p class="western" style="margin-left: 0.62in;"> <b>get_slac_calibdac.py</b>
is controlled by a config file and run without any command line
arguments. The following is a sample config file, which must be named <b>get_slac_calibdac.cfg</b>
and must be located in the current folder:</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">[SETUP]</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">slacuser=strickmn</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">
batfileroot=str34_scp</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">[FM112]</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">summary=139005695</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">disk=u19</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">[FM117]</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">summary=135006789</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">
fle2adcrun=138001234</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">
lac2adcrun=138001236</p>
<p class="western" style="margin-left: 0.62in;">disk=u21</p>
<p class="western" style="margin-left: 0.62in;">The config file items
are described below:</p>
<ul>
  <li>
    <p class="western">[SETUP]</p>
    <ul>
      <li>
        <p class="western">Required section</p>
      </li>
      <li>
        <p class="western">Options</p>
        <ul>
          <li>
            <p class="western">slacuser - (required) specifies username
for SSH logon to slac unix cluster. Note that user must have the
standard GLAST/SAS software environment SSH setup installed, which
allows SSH login via public/private key rather than passwords</p>
          </li>
          <li>
            <p class="western">batfileroot - (optional) specifies the
filename root for the batch file output which contains the SCP commands
to execute. If not present, default of <i>scpcmds</i> is used.
batfileroot can contain path information as well as a filename root,
but should use forward slashes (/) to separate folders</p>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p class="western">[FMXXX]</p>
    <ul>
      <li>
        <p class="western">At least one section required</p>
      </li>
      <li>
        <p class="western">Each section contains information for one
module (XXX is the module serial number, 112 and 117 in the sample)</p>
      </li>
      <li>
        <p class="western">Options</p>
        <ul>
          <li>
            <p class="western">summary - (required unless all other run
numbers are set) specifies the I&amp;T pipeline run number of the
&#226;&#8364;&#339;suite summary&#226;&#8364; for the desired calibDAC run. If summary is
specified, and no individual run numbers are included, the run numbers
of the scripts that produce the desired products are constructed from
the summary run number as follows:</p>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<table border="2" bordercolor="#000000" cellpadding="10" cellspacing="0"
 width="800">
  <col width="259"> <col width="232"> <col width="245"> <tbody>
    <tr valign="top">
      <td width="259">
      <p class="western" style="margin-left: 0.75in;"> <u><b>Script</b></u></p>
      </td>
      <td width="232">
      <p class="western" style="margin-left: 0.75in;"> <u><b>Product</b></u></p>
      </td>
      <td width="245">
      <p class="western" style="margin-left: 0.75in;"> <u><b>Run</b></u></p>
      </td>
    </tr>
    <tr valign="top">
      <td width="259">
      <p class="western" style="margin-left: 0.75in;"> calu_pedestals_ci</p>
      </td>
      <td width="232">
      <p class="western" style="margin-left: 0.75in;"> pedestals</p>
      </td>
      <td width="245">
      <p class="western" style="margin-left: 0.75in;">summary - 6</p>
      </td>
    </tr>
    <tr valign="top">
      <td width="259">
      <p class="western" style="margin-left: 0.75in;"> Calf_gain_p01</p>
      </td>
      <td width="232">
      <p class="western" style="margin-left: 0.75in;"> relgain</p>
      </td>
      <td width="245">
      <p class="western" style="margin-left: 0.75in;">summary - 5</p>
      </td>
    </tr>
    <tr valign="top">
      <td width="259">
      <p class="western" style="margin-left: 0.75in;"> Calf_trg_p03</p>
      </td>
      <td width="232">
      <p class="western" style="margin-left: 0.75in;"> fle2adc</p>
      </td>
      <td width="245">
      <p class="western" style="margin-left: 0.75in;">summary - 4</p>
      </td>
    </tr>
    <tr valign="top">
      <td width="259">
      <p class="western" style="margin-left: 0.75in;"> Calf_trg_p03</p>
      </td>
      <td width="232">
      <p class="western" style="margin-left: 0.75in;"> fhe2adc</p>
      </td>
      <td width="245">
      <p class="western" style="margin-left: 0.75in;">summary - 3</p>
      </td>
    </tr>
    <tr valign="top">
      <td width="259">
      <p class="western" style="margin-left: 0.75in;"> Calf_supp_p01</p>
      </td>
      <td width="232">
      <p class="western" style="margin-left: 0.75in;"> lac2adc</p>
      </td>
      <td width="245">
      <p class="western" style="margin-left: 0.75in;">summary - 2</p>
      </td>
    </tr>
    <tr valign="top">
      <td width="259">
      <p class="western" style="margin-left: 0.75in;"> Calf_rng_p01</p>
      </td>
      <td width="232">
      <p class="western" style="margin-left: 0.75in;"> uld2adc</p>
      </td>
      <td width="245">
      <p class="western" style="margin-left: 0.75in;">summary - 1</p>
      </td>
    </tr>
  </tbody>
</table>
<p class="western" style="margin-left: 0.62in;"><br>
<br>
</p>
<div style="margin-left: 4em;">
<ul>
  <li>
    <p class="western">Note that very early calibDAC runs had calu_init
runs interspersed, resulting in a different relationship of script run
number to summary. These are not currently handled correctly.</p>
  </li>
  <li>
    <p class="western">relgainrun, fle2adcrun, fhe2adcrun, lac2adcrun,
uld2adcrun, pedestalrun - (optional) allow the default run numbers
derived from summary to be overridden or skipped altogether. If any of
these options is set to a run number, that run is used in lieu of that
derived from summary. If the option is set to &#226;&#8364;&#732;skip&#226;&#8364;&#8482;, that product
is not copied</p>
  </li>
  <li>
    <p class="western">disk - (optional) specifies the name of the disk
on which all the products for the module can be found (they all must be
on the same disk). Defaults to u21. The path used to point at to
products at SLAC is /nfs/garm/g/glast/DDD/Integration/rawData/RRRRRRRRR
where DDD is the disk name and RRRRRRRRR is the run number</p>
  </li>
</ul>
</div>
<p class="western" style="margin-left: 0.62in;">Outputs from <b>get_slac_calibdac.py</b>
include the batch file of SCP commands, the downloaded files that
result from execution of the batch file, and a log file from the batch
file execution. This batch file may be run either in Windows or
Linux/UNIX.</p>
<h3 class="western" style="margin-left: 0.31in;"> build_acdsmooth.py</h3>
<p class="western" style="margin-left: 0.62in;"> <b>build_acdsmooth.py</b>
is controlled by a configuration file and a command line parameter. The
command line parameter looks like -<b>f fileroot</b> or <b>--file
fileroot</b> where fileroot is the path and root of the input
configuration file. If the command line argument is not present, the
input configuration filename defaults to <b>build_adcsmooth.cfg</b> in
the current folder. The following is a sample config. File:</p>
<p class="western" style="margin-left: 0.62in;">[FM104]</p>
<p class="western" style="margin-left: 0.62in;">[FM103]</p>
<p class="western" style="margin-left: 0.62in;">flename = skip</p>
<p class="western" style="margin-left: 0.62in;">fhename = test123.xml</p>
<p class="western" style="margin-left: 0.62in;">[FM105]</p>
<p class="western" style="margin-left: 0.62in;">[FM102]</p>
<p class="western" style="margin-left: 0.62in;">[FM107]</p>
<p class="western" style="margin-left: 0.62in;">[FM106]</p>
<p class="western" style="margin-left: 0.62in;">[FM110]</p>
<p class="western" style="margin-left: 0.62in;">[FM108]</p>
<p class="western" style="margin-left: 0.62in;">Note that most of the
module sections are empty. This is the normal mode of operation, in
which <b>build_adcsmooth.py</b> finds the required characterization
files to filter using pattern matching on the file names. If it finds
more than one file matching the pattern, it terminates with an error.
Options include adding filenames to override the automatic filename
determination or adding &#226;&#8364;&#339;skip&#226;&#8364; to not process that particular file.
These are shown in the [FM103] section.</p>
<p class="western" style="margin-left: 0.62in;">The patterns used by
the automatic pattern matching default are shown in the following table:</p>
<table border="1" bordercolor="#000000" cellpadding="10" cellspacing="0"
 width="800">
  <col width="379"> <col width="380"> <tbody>
    <tr valign="top">
      <td width="379">
      <p class="western"><u><b>Type of Characterization File</b></u></p>
      </td>
      <td width="380">
      <p class="western"><u><b>Pattern matching code (matched using
glob))</b></u></p>
      </td>
    </tr>
    <tr valign="top">
      <td width="379">
      <p class="western">FLE</p>
      </td>
      <td width="380">
      <p class="western">'*'+idet+'*fle2adc*.xml'</p>
      </td>
    </tr>
    <tr valign="top">
      <td width="379">
      <p class="western">FHE</p>
      </td>
      <td width="380">
      <p class="western">'*'+idet+'*fhe2adc*.xml'</p>
      </td>
    </tr>
    <tr valign="top">
      <td width="379">
      <p class="western">LAC</p>
      </td>
      <td width="380">
      <p class="western">'*'+idet+'*lac2adc*.xml'</p>
      </td>
    </tr>
    <tr valign="top">
      <td width="379">
      <p class="western">ULD</p>
      </td>
      <td width="380">
      <p class="western"> ('*'+idet+'*uld2adc*.xml&#226;&#8364;&#8482;</p>
      </td>
    </tr>
  </tbody>
</table>
<p class="western" style="margin-left: 0.62in;"><br>
<br>
</p>
<p class="western" style="margin-left: 0.62in;">Outputs from <b>build_acdsmooth.py</b>
include a windows batch file and a UNIX .sh script containing <b>acdsmooth.py</b>
run commands. When executed (outside of the script), these result in
filtered characterization files, with &#226;&#8364;&#339;_filtered&#226;&#8364; added to the end
of each file name.</p>
<h3 class="western" style="margin-left: 0.31in;">
build_gensettings_cfg.py</h3>
<p class="western" style="margin-left: 0.62in;"> <b>build_gensettings_cfg.py</b>
is controlled by a configuration file and a command line parameter. The
latter must look like <b>-f fileroot</b> or <b>--file fileroot</b>,
where fileroot is the path and name root of the input configuration
file. If the command line argument is not present, the input
configuration filename defaults to <b>build_gensettings_cfg.cfg</b> in
the current folder<b>.</b> The following is a sample config file:</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">[FM105]</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">filepath=.</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">config=1</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">tower=4</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;"><br>
</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">[FM102]</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">filepath=.</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">config=1</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">tower=5</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;"><br>
</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">[CFG1]</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">legain=5</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">hegain=15</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">hegainmu=0</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">lac=2</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">fle=100</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">fhe=1</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">adcmargin=50</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;"><br>
</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">[OUTPUT]</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">outputpath=./mydir</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">
outfilename=gensettings_str34_8twr_flight.cfg</p>
<p class="western"
 style="margin-left: 0.62in; margin-top: 0.08in; margin-bottom: 0in;">
The config. Items are described below:</p>
<ul>
  <li>
    <p class="western" style="margin-top: 0.08in; margin-bottom: 0in;">[FMXXX]</p>
    <ul>
      <li>
        <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">At least one section
required</p>
      </li>
      <li>
        <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">Options:</p>
        <ul>
          <li>
            <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">filepath - [required]
specifies the path to the files to be searched (without a trailing
slash). If the current directory is desired, enter &#226;&#8364;&#339;.&#226;&#8364;</p>
          </li>
          <li>
            <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">config - [optional;
defaults to 1] specifies configuration section to be used to define
settings for this module. If set to 1, configuration section is labeled
[CFG1], etc.</p>
          </li>
          <li>
            <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">tower - [required]
specifies the tower number to be used as both source and destination
towers in the genXXXsettings configurations. Note that
genXXXsettings.py currently requires all files for a given run have the
same source tower value. If this is not the case (typically for relgain
files), the file in question must be edited and the TEM ID or GEM ID
tag (depending on file type) altered to be the same as the rest of
files.</p>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p class="western" style="margin-top: 0.08in; margin-bottom: 0in;">[CFGX]</p>
    <ul>
      <li>
        <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">At least one section
required</p>
      </li>
      <li>
        <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">Options</p>
        <ul>
          <li>
            <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">legain - [required] LE
gain setting</p>
          </li>
          <li>
            <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">hegain - [required] HE
gain setting (flight mode)</p>
          </li>
          <li>
            <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">hegainmu - [required]
HE gain setting (muon mode)</p>
          </li>
          <li>
            <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">lac - [required] LAC
threshold setting in MeV</p>
          </li>
          <li>
            <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">fle - [required] FLE
threshold setting in MeV</p>
          </li>
          <li>
            <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">fhe - [required] FHE
threshold setting in GeV</p>
          </li>
          <li>
            <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">adcmargin - [required]
adcmargin setting for ULD setting calculation (ADC units)</p>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p class="western" style="margin-top: 0.08in; margin-bottom: 0in;">[OUTPUT]</p>
    <ul>
      <li>
        <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">Optional section</p>
      </li>
      <li>
        <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">Options</p>
        <ul>
          <li>
            <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">outfilepath -
[optional; defaults to &#226;&#8364;&#339;.&#226;&#8364;] specifies path to output gensettings
config file.</p>
          </li>
          <li>
            <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">outfilename -
[optional; defaults to &#226;&#8364;&#339;gensettings.cfg&#226;&#8364;] specifies name of output
gensettings config file.</p>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<p class="western"
 style="margin-left: 0.62in; margin-top: 0.08in; margin-bottom: 0in;">
Output of <b>build_gensettings_cfg.py</b> includes a single
configuration file for <b>gensettings.py</b>.</p>
<h3 class="western" style="margin-left: 0.31in;"> gensettings.py</h3>
<p class="western"
 style="margin-left: 0.62in; margin-top: 0.08in; margin-bottom: 0in;"> <b>gensettings.py</b>
is controlled by a configuration file as produced by <b>build_gensettings.py</b>
and an optional command line parameter. The latter must look like <b>-f
fileroot</b> or <b>--file fileroot</b> where fileroot is the path and
root of the input configuration file. If the command line parameter is
not specified, the input configuration file name defaults to
gensettings.cfg. A sample configuration file looks like:</p>
<p class="western"
 style="margin-left: 0.62in; margin-top: 0.08in; margin-bottom: 0in;"> <br>
</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">[FM108]</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">adc2nrgname
= .\135004384_T13_FM108_cal_adc2nrg.xml</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">biasname
= .\135004348_T13_FM108_cal_bias.xml</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">relgainname
= .\050817174256_FM108_CAL_relgain.xml</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">flename
= .\050817174720_G5_FM108_CAL_fle2adc_filtered.xml</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">fhename
= .\050817200154_G13_FM108_CAL_fhe2adc_filtered.xml</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">lacname
= .\050817213823_G5_FM108_CAL_lac2adc_filtered.xml</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">uldname
= .\050817214637_G5_FM108_CAL_uld2adc_filtered.xml</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">src
= 13</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">dest
= 13</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">config
= 1</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">.</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">.</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">.</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">[CFG1]</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">legain
= 5</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">hegain
= 15</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">fhe
= 1</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">lac
= 2</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">adcmargin
= 50</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">hegainmu
= 0</p>
<p class="western" style="margin-left: 0.62in; margin-bottom: 0in;">fle
= 100</p>
<p class="western"
 style="margin-left: 0.62in; margin-top: 0.08in; margin-bottom: 0in;">
Note that the config file can have as many [FMXXX] sections as required
for the number of modules for which settings are being generated, and
can have up to 10 [CFGX] sections. In real life, most applications will
only require one [CFGX] section for all modules.</p>
<p class="western"
 style="margin-left: 0.62in; margin-top: 0.08in; margin-bottom: 0in;">
The config. Items are described below:</p>
<ul>
  <li>
    <p class="western" style="margin-top: 0.08in; margin-bottom: 0in;">[FMXXX]</p>
    <ul>
      <li>
        <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">At least one section
required</p>
      </li>
      <li>
        <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">Options:</p>
        <ul>
          <li>
            <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">*name - [required]
specifies the adc2nrg, bias,relgain, fle2adc, fhe2adc, lac2adc and
uld2adc xml file path and name (current directory if no path
specified). If fle, fhe, lac or uld is set to &#226;&#8364;&#339;skip&#226;&#8364;, a
genXXXsettings config and batch command are not generated for that
quantity.</p>
          </li>
          <li>
            <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">src - [required]
specifies source tower number. Must match the TEMID or GEMID tags in
the source (i.e. adc2nrg, bias, etc.) files. All files must have the
same source tower number. If they don&#226;&#8364;&#8482;t, they must be edited to be
the same.</p>
          </li>
          <li>
            <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">dest - [required]
specifies the destination tower number to be used in the output DAC
settings xml files</p>
          </li>
          <li>
            <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">config - [required]
specifies configuration section to be used to define settings for this
module. If set to 1, configuration section is labeled [CFG1], etc.</p>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p class="western" style="margin-top: 0.08in; margin-bottom: 0in;">[CFGX]</p>
    <ul>
      <li>
        <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">At least one section
required</p>
      </li>
      <li>
        <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">Options</p>
        <ul>
          <li>
            <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">legain - [required] LE
gain setting</p>
          </li>
          <li>
            <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">hegain - [required] HE
gain setting (flight mode)</p>
          </li>
          <li>
            <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">hegainmu - [required]
HE gain setting (muon mode)</p>
          </li>
          <li>
            <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">lac - [required] LAC
threshold setting in MeV</p>
          </li>
          <li>
            <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">fle - [required] FLE
threshold setting in MeV</p>
          </li>
          <li>
            <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">fhe - [required] FHE
threshold setting in GeV</p>
          </li>
          <li>
            <p class="western"
 style="margin-top: 0.08in; margin-bottom: 0in;">adcmargin - [required]
adcmargin setting for ULD setting calculation (ADC units)</p>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<p class="western"
 style="margin-left: 0.62in; margin-top: 0.08in; margin-bottom: 0in;">
Output of <b>gensettings.py</b> includes a configuration file and
command line in a batch file for each DAC settings xml file (fle, fhe,
lac and uld) and module as specified by the gensettings configuration
file. If all four settings files are requested for 16 modules, the
output would consist of 64 configuration files (4 x 16) and one batch
file with 64 command lines. As mentioned above, the batch file must be
executed from an environment in which the CALIBGENCAL environment
variable is defined.</p>
<p class="western"
 style="margin-left: 0.62in; margin-top: 0.08in; margin-bottom: 0in;"> <i>Note:</i>
A sh script is generated in parallel w/ the batch file for use on Linux</p>
<p class="western"
 style="margin-left: 0.62in; margin-top: 0.08in; margin-bottom: 0in;">
The output configuration files are defined (for example, in the case of
an FLE file) by the Python code fragment:
fileroot+'_'+idet+"genFLE.cfg" where fileroot is the variable passed in
the <b>gensettings.p</b>y command line and idet is the module number
expressed as, for example, FM104.</p>
<p class="western"
 style="margin-left: 0.62in; margin-top: 0.08in; margin-bottom: 0in;">
The batch file containing the command lines is named fileroot+&#226;&#8364;.bat&#226;&#8364;,
the sh script is fileroot+".sh"</p>
<p class="western"
 style="margin-left: 0.62in; margin-top: 0.08in; margin-bottom: 0in;">A
sample command line from a batch file output looks like:</p>
<p class="western"
 style="margin-left: 1.23in; text-indent: -0.4in; margin-top: 0.08in; margin-bottom: 0in;">
python %CALIBGENCALROOT%\python\genFLEsettings.py -V 100
gensettings_str34_8twr_flight_FM108genFLE.cfg
050915234940_G5_MeV100_FM108_CAL_fle.xml</p>
<p class="western"
 style="margin-left: 0.62in; margin-top: 0.08in; margin-bottom: 0in;">
This shows the use of the CALIBGENCALROOT environment variable (here
for windows) and the naming convention for the xml output file from the
genFLEsettings.py script. Note that the output file name starts with a
time tag and includes, in this case, the gain and FLE setting values.</p>
</body>
</html>
